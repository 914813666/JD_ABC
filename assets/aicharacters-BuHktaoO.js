import{_ as N,u as O,b as r,d as c,e as v,t as $,j as J,r as p,z as T,o as j,F as x,g as C,q as I,m as H,c as A,E as F,h as B,w as V,p as k,R as G,S as K,J as w,T as W,O as S,f as D}from"./index-C_kvG6l8.js";import{S as P}from"./singletonStorage-CNdRZPSt.js";const Q={class:"ai-item-box"},X=["src"],Y={class:"right-box"},Z={class:"item-title"},ee={class:"item-desc"},te={__name:"aicharacter-item",props:{data:{type:Object,default:()=>({})}},setup(g){return O(),(h,m)=>(c(),r("div",Q,[v("img",{src:g.data.botIcon,class:"icon"},null,8,X),v("div",Y,[v("div",Z,$(g.data.botName),1),v("div",ee,$(g.data.botDesc),1)])]))}},M=N(te,[["__scopeId","data-v-d9c6aa36"]]),ae={class:"grid"},oe={__name:"aicharacter-list",props:{data:{type:Object,default:()=>({})}},emits:["scrollEnd"],setup(g,{emit:h}){const m=J(),u=h,a=p(null),t=()=>{debugger;if(console.log("滚动事件触发"),a.value){const{scrollTop:l,scrollHeight:_,clientHeight:i}=a.value;console.log("--------",l,_,i),l+i>=_&&(console.log("滚动到底部了"),u("scrollEnd"))}},y=l=>{localStorage.setItem("botInfo",JSON.stringify(l)),m.push({path:`/${H()}/chat`,query:{botId:l.id}})};return T(()=>{a.value&&a.value.removeEventListener("scroll",t)}),j(()=>{debugger;a.value&&a.value.addEventListener("scroll",t)}),(l,_)=>(c(),r("div",{class:"grid-box",ref_key:"girdBox",ref:a},[v("div",ae,[(c(!0),r(x,null,C(g.data,(i,b)=>(c(),I(M,{key:b,data:i,onClick:E=>y(i)},null,8,["data","onClick"]))),128))])],512))}},le=N(oe,[["__scopeId","data-v-24afddbe"]]),se={class:"c-box"},ne={class:"tabs-box"},ce={key:1,style:{display:"flex","justify-content":"center","align-items":"center"}},re={key:2},ue={__name:"aicharacters",setup(g){const{isWeb:h}=O(),m=J();P.getInstance();const u=p(!1),a=p(0),t=p([]),y=A(()=>"var(--frame-bg)"),l=p(null),_=()=>{if(console.log("滚动事件触发"),l.value){const{scrollTop:e,scrollHeight:o,clientHeight:s}=l.value;console.log("--------",e,o,s),e+s>=o&&console.log("滚动到底部了")}},i=async()=>{let e=localStorage.getItem("aiCharaCache");if(e){t.value=JSON.parse(e);return}let o=await G({bundleId:w(),language:K()});console.log("tabs",o),o.code==200&&(t.value=o.data.rows||[]),t.value.length>0&&(a.value=0,b(t.value[0].id,t.value[0].language,1))},b=async(e,o,s=1)=>{u.value=!0;let d=await W({groupId:e,bundleId:w(),language:o},{pageSize:10,pageNum:s});u.value=!1,t.value.forEach(n=>{n.id==e&&(n.total=d.total,s<=1?n.botInfoVos=d.rows||[]:n.botInfoVos=n.botInfoVos.concat(d.rows||[]),n.pageNum=s)});let f=JSON.stringify(t.value);localStorage.setItem("aiCharaCache",f)},E=async()=>{var f;debugger;if(console.log("loadMore"),u.value)return;let e=t.value[a.value].id,o=t.value[a.value].total,s=t.value[a.value].language;if(((f=t.value[a.value].botInfoVos)==null?void 0:f.length)>=o)return;u.value=!0;let d=(t.value[a.value].pageNum||1)+1;b(e,s,d)},R=async e=>{var o,s;console.log("index-----",e);debugger;((s=(o=t.value[e])==null?void 0:o.botInfoVos)==null?void 0:s.length)>0||b(t.value[e].id,t.value[e].language)},q=e=>{console.log("item",e),localStorage.setItem("botInfo",JSON.stringify(e)),m.push({path:`/${H()}/chat`,query:{botId:e.id}})};return T(()=>{l.value&&l.value.removeEventListener("scroll",_)}),j(()=>{F(()=>{i()}),l.value&&l.value.addEventListener("scroll",_)}),(e,o)=>{const s=k("a-spin"),d=k("van-tab"),f=k("van-tabs");return c(),r("div",se,[v("div",ne,[B(f,{active:a.value,"onUpdate:active":o[0]||(o[0]=n=>a.value=n),class:"vantabs",background:y.value,color:"var(--ai-c-slider-thumb)","title-active-color":"var(--text-color)","title-inactive-color":"var(--text-80-color)",onChange:R},{default:V(()=>[(c(!0),r(x,null,C(t.value,(n,U)=>(c(),I(d,{title:n.groupName,key:U},{default:V(()=>[v("div",null,[D(h)?(c(),I(le,{key:0,data:n.botInfoVos||[],onScrollEnd:E},null,8,["data"])):S("",!0),u.value?(c(),r("div",ce,[B(s)])):S("",!0),D(h)?S("",!0):(c(),r("div",re,[(c(!0),r(x,null,C(n.botInfoVos||[],(L,z)=>(c(),I(M,{key:z,data:L,onClick:ie=>q(L),class:"mt-[12px]"},null,8,["data","onClick"]))),128))]))])]),_:2},1032,["title"]))),128))]),_:1},8,["active","background"])])])}}},ge=N(ue,[["__scopeId","data-v-7422478f"]]);export{ge as default};
