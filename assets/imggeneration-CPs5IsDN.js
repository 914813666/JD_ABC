import{$ as R,a0 as Fe,a1 as $,a2 as qe,a3 as Ne,s as _e,c as N,o as be,a4 as ze,f as p,a5 as We,_ as je,u as He,v as Je,r,j as Qe,x as Ke,y as Xe,l as Ye,a6 as Ze,E as ce,k as et,b as T,d as S,e as w,F as tt,g as at,h as L,p as ue,i as ot,O as D,t as Q,P as de,w as P,q as nt,Q as st,m as lt,I as rt,J as pe,a7 as it,M as ve,a8 as ct}from"./index-C_kvG6l8.js";import{s as ut}from"./send-Cd0KvxUx.js";import{m as dt,H as q,a as pt,s as vt,c as ft}from"./index-F-jQkbkM.js";import{r as fe,a as ge,g as gt,b as me,p as mt,c as ye,d as yt}from"./pic_save-mrS83vCy.js";/* empty css               */function ke(o){return qe()?(Ne(o),!0):!1}const X=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ht=Object.prototype.toString,_t=o=>ht.call(o)==="[object Object]";function bt(o){let a;function u(){return a||(a=o()),a}return u.reset=async()=>{const b=a;a=void 0,b&&await b},u}function K(o){return Array.isArray(o)?o:[o]}function kt(o,a,u={}){const{immediate:b=!0,immediateCallback:I=!1}=u,g=R(!1);let h=null;function s(){h&&(clearTimeout(h),h=null)}function i(){g.value=!1,s()}function l(...v){I&&o(),s(),g.value=!0,h=setTimeout(()=>{g.value=!1,h=null,o(...v)},$(a))}return b&&(g.value=!0,X&&l()),ke(i),{isPending:Fe(g),start:l,stop:i}}function wt(o,a,u){return _e(o,a,{...u,immediate:!0})}const It=X?window:void 0,we=X?window.navigator:void 0;function St(o){var a;const u=$(o);return(a=u==null?void 0:u.$el)!=null?a:u}function Ie(...o){const a=[],u=()=>{a.forEach(s=>s()),a.length=0},b=(s,i,l,v)=>(s.addEventListener(i,l,v),()=>s.removeEventListener(i,l,v)),I=N(()=>{const s=K($(o[0])).filter(i=>i!=null);return s.every(i=>typeof i!="string")?s:void 0}),g=wt(()=>{var s,i;return[(i=(s=I.value)==null?void 0:s.map(l=>St(l)))!=null?i:[It].filter(l=>l!=null),K($(I.value?o[1]:o[0])),K(p(I.value?o[2]:o[1])),$(I.value?o[3]:o[2])]},([s,i,l,v])=>{if(u(),!(s!=null&&s.length)||!(i!=null&&i.length)||!(l!=null&&l.length))return;const d=_t(v)?{...v}:v;a.push(...s.flatMap(U=>i.flatMap(A=>l.map(E=>b(U,A,E,d)))))},{flush:"post"}),h=()=>{g(),u()};return ke(u),h}function Tt(){const o=R(!1),a=ze();return a&&be(()=>{o.value=!0},a),o}function Se(o){const a=Tt();return N(()=>(a.value,!!o()))}function he(o,a={}){const{controls:u=!1,navigator:b=we}=a,I=Se(()=>b&&"permissions"in b),g=R(),h=typeof o=="string"?{name:o}:o,s=R(),i=()=>{var v,d;s.value=(d=(v=g.value)==null?void 0:v.state)!=null?d:"prompt"};Ie(g,"change",i,{passive:!0});const l=bt(async()=>{if(I.value){if(!g.value)try{g.value=await b.permissions.query(h)}catch{g.value=void 0}finally{i()}if(u)return We(g.value)}});return l(),u?{state:s,isSupported:I,query:l}:s}function Ct(o={}){const{navigator:a=we,read:u=!1,source:b,copiedDuring:I=1500,legacy:g=!1}=o,h=Se(()=>a&&"clipboard"in a),s=he("clipboard-read"),i=he("clipboard-write"),l=N(()=>h.value||g),v=R(""),d=R(!1),U=kt(()=>d.value=!1,I,{immediate:!1});async function A(){let f=!(h.value&&G(s.value));if(!f)try{v.value=await a.clipboard.readText()}catch{f=!0}f&&(v.value=O())}l.value&&u&&Ie(["copy","cut"],A,{passive:!0});async function E(f=$(b)){if(l.value&&f!=null){let y=!(h.value&&G(i.value));if(!y)try{await a.clipboard.writeText(f)}catch{y=!0}y&&B(f),v.value=f,d.value=!0,U.start()}}function B(f){const y=document.createElement("textarea");y.value=f??"",y.style.position="absolute",y.style.opacity="0",document.body.appendChild(y),y.select(),document.execCommand("copy"),y.remove()}function O(){var f,y,M;return(M=(y=(f=document==null?void 0:document.getSelection)==null?void 0:f.call(document))==null?void 0:y.toString())!=null?M:""}function G(f){return f==="granted"||f==="prompt"}return{isSupported:l,text:v,copied:d,copy:E}}const Lt={class:"container"},xt=["onMouseenter","onMouseleave"],Dt={class:"pro-top-item"},Mt={class:"problem-box"},$t=["src"],Rt={class:"problem",style:{display:"inline-block","white-space":"pre-line"}},Ut={class:"pro-bottom-item"},At=["src","onClick"],Et=["onClick","src"],Bt=["onMouseenter","onMouseleave"],Ot={class:"anw-item-top"},Vt=["src"],Pt={key:3,class:"answer-point"},Gt={class:"custom-text"},Ft={class:"anw-item-bottom"},qt=["onClick","src"],Nt=["onClick","src"],zt=["src","onClick"],Wt={key:1,class:"loading"},jt={class:"sendbox"},Ht={__name:"imggeneration",setup(o){ot(e=>({e26be5a4:!p(b)&&p(I)?"fixed":"absolute",d8597de8:p(g)?"35px":"16px","04a5b31c":p(u)?"300px":"280px","869c4b54":p(a)?"rgb(128, 128, 129)":"#717274"}));const{isLight:a}=Ye(),{isMobile:u,isWeb:b,isPortrait:I,isTablet:g}=He();dt.setOptions({highlight:function(e,t){try{const c=q.getLanguage(t)?t:"plaintext";return q.highlight(e,{language:c}).value}catch(c){return console.warn("代码高亮失败:",c),q.highlightAuto(e).value}},breaks:!0,gfm:!0});const h=Qe(),s=Je(),i=r(""),l=r(!1),v=r(""),d=r("");r("");const U=r(0),A=r(0),E=r({}),B=r(-1),O=r(-1),G=r(-1),f=r(-1),y=r(null),M=r(null),Te=r(null),Ce=r(null),Y=r(""),Z=r("1:1"),x=r(""),ee=r(null),z=r(""),W=r(!1),te=r(""),k=r([]);_e(()=>h.currentRoute.value,e=>{let t=e.query;t.conversationId&&d.value!=""&&t.conversationId!=d.value&&(d.value=t.conversationId,re())},{immediate:!0}),N(()=>U.value==0?a.value?Ke:Xe:E.value.botIcon);const Le=e=>{debugger;Z.value=e},xe=(e,t)=>e==O.value?a.value?ye:ye:a.value?yt:pt,De=async(e,t,c)=>{{Te.value=t,B.value=t;const{copy:_}=Ct({source:e});await _(),O.value=B.value,B.value=-1,Ce.value=-1,G.value=-1}setTimeout(()=>{O.value=-1,f.value=-1},1e3)},Me=e=>{s.imgModelList.modelList.find(_=>_.aiVersion=="BOLATU:gpt-4o-image")?s.setImgAiVersion("BOLATU:gpt-4o-image"):console.log("当前model列表没有找到BOLATU:gpt-4o-image"),te.value=e.reply,z.value=e.problem,i.value=e.problem},$e=async e=>{l.value||e&&se(e)},Re=async e=>{z.value=e,i.value=e},ae=(e,t)=>{t=="right"?y.value=e:M.value=e},oe=e=>{M.value=null,y.value=null},Ue=async e=>{const t=document.createElement("a");t.href=e,t.download="image.png",t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)},Ae=()=>{l.value=!0;let e=0;const t=setInterval(()=>{e=(e+1)%4,v.value=".".repeat(e),l.value||clearInterval(t)},500);return t},F=r(null),ne=()=>{ce(()=>{F.value&&(F.value.scrollTop=F.value.scrollHeight)})},se=async e=>{if(e.length==0)return;i.value=e;let t={problem:e,reply:"",typingInterval:null};if(A.value==1?t.type="pic":t.type="text",console.log("params:",s.userInfo),!s.userInfo){h.push({path:`/${lt()}/login`});return}if(x.value){const c=new Blob([x.value],{type:x.value.type}),n=await(C=>new Promise(m=>{const V=new FileReader;V.onloadend=()=>m(V.result),V.readAsDataURL(C)}))(c);t.base64String=n,console.log(n)}k.value.push(t),Ae(),Ee(),ne()},Ee=async()=>{var e="";if(x.value){const V=new Blob([x.value],{type:x.value.type});let ie=new FormData;ie.append("file",V,x.value.name);let J=await rt(ie);J.code==200&&(console.log("图片上传成功:",J),e=J.data.url)}const t=k.value.length-1,c=k.value[t];let _={bundleId:pe(),mac:s.ip,prompt:i.value,aiVersion:s.imgAiVersion,overrideSize:Z.value,styleText:Y.value,imageUrl:e,conversationId:d.value||""};console.log("请求参数:",_),_.signature=vt(_);var n=ft(JSON.stringify(_)),C={bundleId:pe(),security:n};(d.value==null||d.value=="")&&le();let m=await it(C);l.value=!1,m.code==200?(console.log("图片生成成功:",m),m.data&&(c.picId=m.data.id,c.reply="",c.drawTaskStatus=m.data.drawTaskStatus,(d.value==0||!d.value)&&ve.emit("refreshLeftList","image"),d.value=m.data.conversationId||"",Oe())):m.code==-3&&(c.showGoVip=!0)},j=r(null),le=()=>{j.value&&clearInterval(j.value),j.value=setInterval(async()=>{Be()},1e3*1)},Be=()=>{k.value.forEach(e=>{if(e.drawTaskStatus!="completed"||e.drawTaskStatus!="failed")if(e!=null&&e.startTime){let t=(new Date().valueOf()-e.startTime)/1e3;e.timeLeft=60-Math.floor(t),e.timeLeft<=3&&(e.timeLeft=3)}else e.startTime=new Date().valueOf(),e.timeLeft=60})},H=r(null),Oe=async()=>{H.value&&clearInterval(H.value),H.value=setInterval(async()=>{k.value.filter(t=>t.drawTaskStatus!=="completed").filter(t=>t.drawTaskStatus!=="failed").map(t=>t.picId).forEach(async t=>{await Ve(t)})},1e3*5)},Ve=async e=>{var _;var t=k.value.find(n=>n.picId==e);let c=await ct(e);if(c.code==200){debugger;if(c.data.drawTaskStatus=="completed"){if(t&&((_=c.data)==null?void 0:_.imageUrlList.length)>0){t.reply=c.data.imageUrlList[0],t.drawTaskStatus=c.data.drawTaskStatus,console.log("图片生成成功:",k.value);debugger;e==k.value[0].picId&&ve.emit("refreshLeftList","image")}}else c.data.drawTaskStatus=="failed"&&(t.drawTaskStatus=c.data.drawTaskStatus,t.reply="Unable to generate image, please try to change the prompt word",console.log("图片生成失败:",k.value))}},Pe=()=>{Ge()},Ge=()=>{ee.value&&(ee.value.abort(),l.value=!1,console.log("流已暂停"))},re=async()=>{W.value=!0;const e=await Ze({conversationId:d.value});W.value=!1,e.code==200&&(k.value=(e.rows||[]).reverse(),k.value.forEach(t=>{t.problem=t.prompt,t.ossUrl!=null&&t.ossUrl!=""&&(t.reply=t.ossUrl,t.drawTaskStatus="completed")}),console.log("list:",k.value),ce(()=>{document.querySelectorAll("pre code").forEach(t=>{q.highlightElement(t)})})),le(),ne()};return be(async()=>{const e=et();d.value=e.query.conversationId,d.value&&re()}),(e,t)=>{const c=ue("el-tooltip"),_=ue("a-spin");return S(),T("div",Lt,[W.value?(S(),T("div",Wt,[L(_,{size:"large"})])):(S(),T("div",{key:0,class:"content",ref_key:"contentRef",ref:F},[(S(!0),T(tt,null,at(k.value,(n,C)=>(S(),T("div",{key:C,class:"item"},[n.problem?(S(),T("div",{key:0,class:"pro-item",onMouseenter:m=>ae(C,"right"),onMouseleave:m=>oe()},[w("div",Dt,[w("div",Mt,[w("img",{src:n.base64String,class:"problm-img"},null,8,$t),w("div",Rt,Q(n.problem),1)]),L(de,{class:"mt-[6px]"})]),w("div",Ut,[L(c,{effect:p(a)?"light":"dark",content:e.$t("Copy"),placement:"top"},{default:P(()=>[w("img",{src:xe(C,"right"),class:"copy_img",onClick:m=>De(n.problem,C,"right")},null,8,At)]),_:2},1032,["effect","content"]),L(c,{effect:p(a)?"light":"dark",content:e.$t("Edit"),placement:"top"},{default:P(()=>[w("img",{onClick:m=>Re(n.problem),src:p(a)?p(fe):p(ge),class:"copy_img ml-[16px]"},null,8,Et)]),_:2},1032,["effect","content"]),t[2]||(t[2]=w("div",{class:"w-[40px] h-[40px] ml-[6px]"},null,-1))])],40,xt)):D("",!0),w("div",{class:"anw-item",onMouseenter:m=>ae(C,"left"),onMouseleave:m=>oe()},[w("div",Ot,[L(de,{class:"mr-[6px]"}),n.reply&&n.drawTaskStatus=="completed"?(S(),T("img",{key:0,src:n.reply,class:"create_img"},null,8,Vt)):D("",!0),n.showGoVip?(S(),nt(gt,{key:1})):D("",!0),n.drawTaskStatus=="failed"?(S(),T("div",{key:2,class:st(["answer",{typing:C==k.value.length-1&&l.value}])},Q(e.$t(n.reply)),3)):n.drawTaskStatus!="completed"&&!n.showGoVip?(S(),T("div",Pt,[L(_),w("div",Gt,Q(e.$t("Generated in {count} seconds",{count:n.timeLeft})),1)])):D("",!0)]),w("div",Ft,[t[3]||(t[3]=w("div",{class:"w-[40px] h-[40px] ml-[6px]"},null,-1)),L(c,{effect:p(a)?"light":"dark",content:e.$t("Copy"),placement:"top"},{default:P(()=>[n.reply?(S(),T("img",{key:0,onClick:m=>$e(n.problem),src:p(a)?p(me):p(me),class:"copy_img mr-[16px]"},null,8,qt)):D("",!0)]),_:2},1032,["effect","content"]),L(c,{effect:p(a)?"light":"dark",content:e.$t("Edit"),placement:"top"},{default:P(()=>[n.reply?(S(),T("img",{key:0,onClick:m=>Me(n),src:p(a)?p(fe):p(ge),class:"copy_img mr-[16px]"},null,8,Nt)):D("",!0)]),_:2},1032,["effect","content"]),L(c,{effect:p(a)?"light":"dark",content:e.$t("Download"),placement:"top"},{default:P(()=>[n.reply&&n.drawTaskStatus=="completed"?(S(),T("img",{key:0,src:p(mt),class:"copy_img mr-[16px]",onClick:m=>Ue(n.reply)},null,8,zt)):D("",!0)]),_:2},1032,["effect","content"])])],40,Bt)]))),128))],512)),w("div",jt,[L(ut,{type:"img",onOk:se,onStop:Pe,loading:l.value,text:z.value,onStyleChange:t[0]||(t[0]=n=>Y.value=n),onSizeChange:Le,onNeedFile:t[1]||(t[1]=n=>x.value=n),imgUrl:te.value},null,8,["loading","text","imgUrl"])])])}}},Zt=je(Ht,[["__scopeId","data-v-bcd8b133"]]);export{Zt as default};
